<!DOCTYPE HTML>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài thi trắc nghiệm Lịch sử</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            color: #333;
        }

        .quiz-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        h1, h2 {
            text-align: center;
            color: #2c7a7b;
        }

        .username {
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .question {
            margin-bottom: 30px;
        }

        .question p {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .answers label {
            display: block;
            font-size: 16px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .answers input {
            margin-right: 10px;
        }

        .submit-btn,
        .cert-btn,
        .back-button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #2c7a7b;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            margin-top: 10px;
        }

        .submit-btn:hover,
        .cert-btn:hover,
        .back-btn:hover {
            background-color: #285e61;
        }

        .camera-frame {
            position: fixed; /* Giữ cố định */
            top: 20px; /* Điều chỉnh vị trí */
            right: 20px; /* Đặt ở góc phải */
            width: 200px;
            height: 150px;
            border: 2px solid #2c7a7b;
            border-radius: 10px;
            overflow: hidden;
            background-color: black;
            z-index: 1000; /* Đảm bảo nó nằm trên nội dung khác */
            cursor: move; /* Hiển thị con trỏ di chuyển */
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message {
            display: none;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            border-radius: 5px;
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            font-size: 18px;
        }

        .footer {
            text-align: center;
            padding: 20px 0;
            background-color: #2c7a7b;
            color: white;
            margin-top: auto;
        }

        .footer p {
            margin: 0;
        }

        .timer {
            background-color: #f5f5f5;
            border-radius: 10px;
            padding: 10px 20px;
            text-align: center;
            font-size: 22px;
            color: #e53e3e;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* Responsive Design */
        @media screen and (max-width: 768px) {
            .quiz-container {
                padding: 15px;
            }

            .submit-btn {
                font-size: 16px;
            }

            h1 {
                font-size: 24px;
            }

            .question p {
                font-size: 16px;
            }

            .camera-frame {
                width: 150px; /* Kích thước nhỏ hơn trên di động */
                height: 100px; /* Kích thước nhỏ hơn trên di động */
            }
        }
    </style>
</head>

<body>
    <div class="camera-frame" id="cameraFrame">
        <video id="camera" autoplay></video>
    </div>
    <div class="quiz-container">
        <h1>Bài thi trắc nghiệm Lịch sử</h1>
        <h2>Bạn phải đúng 15/20 câu</h2>
        <h2>Mới được nhận chứng chỉ</h2>
        
        <p class="username" id="username">Tên người dùng: Đang tải...</p>
        <div id="timer" class="timer">Thời gian: 04:00</div>
        <form id="quizForm"></form>
        <button type="button" class="submit-btn" onclick="submitQuiz()">Nộp bài</button>
        <div id="message" class="message">Cảm ơn bạn đã hoàn thành bài thi!</div>
        <button type="button" class="cert-btn" id="certBtn" style="display: none;" onclick="getCertificate()">Nhận chứng chỉ</button>
        <button class="back-button" onclick="goBack()">Quay lại</button>
    </div>
    <div class="footer">
        <p>Thiết kế bởi GKNM</p>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCer_BVSGUIICAocIOwiqGwtHSbmUTy-TI",
            authDomain: "luutru-2fc0c.firebaseapp.com",
            projectId: "luutru-2fc0c",
            storageBucket: "luutru-2fc0c.appspot.com",
            messagingSenderId: "447316566416",
            appId: "1:447316566416:web:8ea9562ef016528232d315",
            measurementId: "G-QLE52FWS60"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let timerValue = 240;
        const timerElement = document.getElementById('timer');
        const message = document.getElementById('message');
        const quizForm = document.getElementById('quizForm');
        const certBtn = document.getElementById('certBtn');
        const usernameElement = document.getElementById('username');
        let selectedQuestions = [];
        let username = "";
        let cameraActive = true;

        const questionBank = [
    { question: 'Năm nào diễn ra cuộc kháng chiến chống Pháp ở miền Bắc?', options: ['1945', '1946', '1947', '1948'], answer: '1946' },
    { question: 'Ai là người đứng đầu chính phủ Việt Nam trong giai đoạn kháng chiến chống Pháp?', options: ['Hồ Chí Minh', 'Lê Duẩn', 'Trường Chinh', 'Nguyễn Văn Linh'], answer: 'Hồ Chí Minh' },
    { question: 'Năm nào diễn ra cuộc kháng chiến chống thực dân Pháp lần thứ ba?', options: ['1945', '1946', '1947', '1948'], answer: '1946' },
    { question: 'Ai là người đã lãnh đạo cuộc khởi nghĩa Yên Thế lần thứ hai?', options: ['Đề Thám', 'Hồ Chí Minh', 'Võ Nguyên Giáp', 'Nguyễn Huệ'], answer: 'Đề Thám' },
    { question: 'Chiến dịch nào đã diễn ra vào tháng 5 năm 1954?', options: ['Điện Biên Phủ', 'Hà Nội', 'Củ Chi', 'Nam Bộ'], answer: 'Điện Biên Phủ' },
    { question: 'Ai là người sáng lập Đảng Cộng sản Việt Nam?', options: ['Hồ Chí Minh', 'Lê Duẩn', 'Trường Chinh', 'Nguyễn Văn Linh'], answer: 'Hồ Chí Minh' },
    { question: 'Năm nào Việt Nam thống nhất đất nước?', options: ['1975', '1976', '1977', '1978'], answer: '1975' },
    { question: 'Ai là Tổng tư lệnh quân đội nhân dân Việt Nam trong cuộc kháng chiến chống Mỹ?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Nguyễn Văn Linh', 'Lê Duẩn'], answer: 'Võ Nguyên Giáp' },
    { question: 'Cuộc kháng chiến chống Mỹ bắt đầu từ năm nào?', options: ['1954', '1960', '1965', '1975'], answer: '1965' },
    { question: 'Năm nào diễn ra Hội nghị Geneva?', options: ['1954', '1956', '1958', '1960'], answer: '1954' },
    { question: 'Ai là người lãnh đạo cuộc khởi nghĩa tháng Tám năm 1945?', options: ['Hồ Chí Minh', 'Trường Chinh', 'Võ Nguyên Giáp', 'Nguyễn Văn Linh'], answer: 'Hồ Chí Minh' },
    { question: 'Năm nào diễn ra cuộc cách mạng tháng Tám?', options: ['1945', '1946', '1947', '1948'], answer: '1945' },
    { question: 'Ai là người ký hiệp định Paris năm 1973?', options: ['Hồ Chí Minh', 'Lê Đức Thọ', 'Nguyễn Văn Thiệu', 'Trường Chinh'], answer: 'Lê Đức Thọ' },
    { question: 'Nước nào đã thả quả bom nguyên tử đầu tiên xuống Hiroshima?', options: ['Mỹ', 'Liên Xô', 'Nhật Bản', 'Đức'], answer: 'Mỹ' },
    { question: 'Năm 1789, cuộc Cách mạng Pháp bắt đầu tại thành phố nào?', options: ['Paris', 'London', 'Berlin', 'Roma'], answer: 'Paris' },
    { question: 'Ai là nữ hoàng nổi tiếng của Ai Cập cổ đại?', options: ['Cleopatra', 'Nefertiti', 'Hatshepsut', 'Isis'], answer: 'Cleopatra' },
    { question: 'Năm nào diễn ra cuộc tổng tấn công Tết Mậu Thân?', options: ['1968', '1969', '1970', '1971'], answer: '1968' },
    { question: 'Ai là người viết bản Tuyên ngôn độc lập của Việt Nam?', options: ['Hồ Chí Minh', 'Trường Chinh', 'Lê Duẩn', 'Nguyễn Văn Linh'], answer: 'Hồ Chí Minh' },
    { question: 'Cuộc kháng chiến chống Mỹ kết thúc vào năm nào?', options: ['1973', '1975', '1976', '1977'], answer: '1975' },
    { question: 'Năm nào Việt Nam gia nhập Liên Hợp Quốc?', options: ['1975', '1976', '1977', '1978'], answer: '1977' },
    { question: 'Ai là người lãnh đạo cuộc kháng chiến chống thực dân Pháp ở Bắc Kỳ?', options: ['Hồ Chí Minh', 'Nguyễn Huệ', 'Đề Thám', 'Lê Duẩn'], answer: 'Đề Thám' },
    { question: 'Năm nào diễn ra cuộc chiến tranh biên giới phía Bắc?', options: ['1979', '1980', '1981', '1982'], answer: '1979' },
    { question: 'Ai là người lãnh đạo cuộc khởi nghĩa chống thực dân Pháp ở miền Nam?', options: ['Hồ Chí Minh', 'Nguyễn Văn Linh', 'Trần Văn Giàu', 'Lê Duẩn'], answer: 'Trần Văn Giàu' },
    { question: 'Ai là tác giả của tác phẩm "Tuyên ngôn độc lập"?', options: ['Hồ Chí Minh', 'Tố Hữu', 'Chế Lan Viên', 'Xuân Diệu'], answer: 'Hồ Chí Minh' },
    { question: 'Năm nào diễn ra chiến dịch Điện Biên Phủ?', options: ['1954', '1955', '1956', '1957'], answer: '1954' },
    { question: 'Ai là người ký hiệp định Geneva?', options: ['Hồ Chí Minh', 'Lê Đức Thọ', 'Nguyễn Văn Thiệu', 'Trường Chinh'], answer: 'Hồ Chí Minh' },
    { question: 'Năm nào diễn ra cuộc kháng chiến chống Mỹ cứu nước?', options: ['1954', '1965', '1975', '1976'], answer: '1965' },
    { question: 'Ai là người lãnh đạo cuộc kháng chiến chống Pháp ở miền Bắc?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Lê Duẩn', 'Trường Chinh'], answer: 'Hồ Chí Minh' },
    { question: 'Ai là Tổng thống đầu tiên của Việt Nam Cộng Hòa?', options: ['Nguyễn Văn Thiệu', 'Ngô Đình Diệm', 'Trần Văn Hương', 'Lê Văn Viễn'], answer: 'Ngô Đình Diệm' },
    { question: 'Năm nào diễn ra cuộc tấn công vào Huế?', options: ['1968', '1969', '1970', '1971'], answer: '1968' },
    { question: 'Chiến tranh Việt Nam diễn ra từ năm nào đến năm nào?', options: ['1954-1975', '1950-1975', '1954-1970', '1955-1975'], answer: '1954-1975' },
    { question: 'Ai là người lãnh đạo cuộc tổng tấn công Tết Mậu Thân?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Lê Duẩn', 'Nguyễn Văn Linh'], answer: 'Võ Nguyên Giáp' },
    { question: 'Năm nào Việt Nam ký hiệp định Paris?', options: ['1973', '1974', '1975', '1976'], answer: '1973' },
    { question: 'Năm nào diễn ra cuộc kháng chiến chống thực dân Pháp lần thứ nhất?', options: ['1945', '1946', '1947', '1948'], answer: '1945' },
    { question: 'Ai là người đã lãnh đạo cuộc khởi nghĩa Bắc Sơn?', options: ['Đề Thám', 'Hồ Chí Minh', 'Nguyễn Ái Quốc', 'Võ Nguyên Giáp'], answer: 'Nguyễn Ái Quốc' },
    { question: 'Năm nào diễn ra cuộc kháng chiến chống Mỹ ở miền Nam?', options: ['1954', '1960', '1965', '1975'], answer: '1965' },
    { question: 'Ai là người ký hiệp định đình chiến tại Bác', options: ['Hồ Chí Minh', 'Lê Đức Thọ', 'Nguyễn Văn Thiệu', 'Trường Chinh'], answer: 'Lê Đức Thọ' },
    { question: 'Năm nào diễn ra cuộc tổng tấn công vào Sài Gòn?', options: ['1975', '1976', '1977', '1978'], answer: '1975' },
    { question: 'Ai là lãnh đạo của Việt Nam trong cuộc kháng chiến chống Mỹ?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Lê Duẩn', 'Nguyễn Văn Linh'], answer: 'Lê Duẩn' },
    { question: 'Cuộc chiến tranh Việt Nam kết thúc vào năm nào?', options: ['1973', '1975', '1976', '1977'], answer: '1975' },
    { question: 'Ai là người lãnh đạo cuộc kháng chiến chống thực dân Pháp ở Nam Bộ?', options: ['Hồ Chí Minh', 'Nguyễn Văn Linh', 'Trần Văn Giàu', 'Lê Duẩn'], answer: 'Trần Văn Giàu' },
    { question: 'Năm nào diễn ra chiến dịch Hồ Chí Minh?', options: ['1975', '1976', '1977', '1978'], answer: '1975' },
    { question: 'Ai là Tổng tư lệnh trong trận Điện Biên Phủ?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Nguyễn Văn Linh', 'Lê Duẩn'], answer: 'Võ Nguyên Giáp' },
    { question: 'Năm nào diễn ra chiến dịch tổng tấn công Tết Mậu Thân?', options: ['1968', '1969', '1970', '1971'], answer: '1968' },
    { question: 'Ai là người viết bản Tuyên ngôn độc lập của Việt Nam?', options: ['Hồ Chí Minh', 'Trường Chinh', 'Lê Duẩn', 'Nguyễn Văn Linh'], answer: 'Hồ Chí Minh' },
    { question: 'Cuộc kháng chiến chống Pháp ở Việt Nam kết thúc vào năm nào?', options: ['1954', '1955', '1956', '1957'], answer: '1954' },
    { question: 'Năm nào diễn ra cuộc chiến tranh biên giới Việt - Trung?', options: ['1979', '1980', '1981', '1982'], answer: '1979' },
    { question: 'Ai là người lãnh đạo cuộc kháng chiến chống Pháp ở miền Bắc?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Lê Duẩn', 'Trường Chinh'], answer: 'Hồ Chí Minh' },
    { question: 'Năm nào diễn ra cuộc tổng tấn công vào Sài Gòn?', options: ['1975', '1976', '1977', '1978'], answer: '1975' },
    { question: 'Ai là Tổng thống đầu tiên của Việt Nam Cộng Hòa?', options: ['Nguyễn Văn Thiệu', 'Ngô Đình Diệm', 'Trần Văn Hương', 'Lê Văn Viễn'], answer: 'Ngô Đình Diệm' },
    { question: 'Năm nào Việt Nam giành được độc lập?', options: ['1945', '1946', '1947', '1948'], answer: '1945' },
    { question: 'Ai là người lãnh đạo cuộc kháng chiến chống Mỹ ở miền Bắc?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Lê Duẩn', 'Trường Chinh'], answer: 'Hồ Chí Minh' },
    { question: 'Năm nào diễn ra cuộc chiến tranh Việt Nam?', options: ['1954-1975', '1960-1975', '1950-1975', '1965-1975'], answer: '1954-1975' },
    { question: 'Ai là người ký hiệp định đình chiến tại Bác?', options: ['Hồ Chí Minh', 'Lê Đức Thọ', 'Nguyễn Văn Thiệu', 'Trường Chinh'], answer: 'Lê Đức Thọ' },
    { question: 'Năm nào diễn ra cuộc kháng chiến chống thực dân Pháp lần thứ nhất?', options: ['1945', '1946', '1947', '1948'], answer: '1945' },
    { question: 'Ai là người đã lãnh đạo cuộc khởi nghĩa Bắc Sơn?', options: ['Đề Thám', 'Hồ Chí Minh', 'Nguyễn Ái Quốc', 'Võ Nguyên Giáp'], answer: 'Nguyễn Ái Quốc' },
    { question: 'Năm nào diễn ra cuộc kháng chiến chống thực dân Pháp lần thứ hai?', options: ['1945', '1946', '1947', '1948'], answer: '1946' },
    { question: 'Ai là người lãnh đạo cuộc kháng chiến chống Pháp ở miền Nam?', options: ['Hồ Chí Minh', 'Nguyễn Văn Linh', 'Trần Văn Giàu', 'Lê Duẩn'], answer: 'Trần Văn Giàu' },
    { question: 'Năm nào diễn ra cuộc tổng tấn công vào Huế?', options: ['1968', '1969', '1970', '1971'], answer: '1968' },
    { question: 'Ai là người ký hiệp định Paris?', options: ['Hồ Chí Minh', 'Lê Đức Thọ', 'Nguyễn Văn Thiệu', 'Trường Chinh'], answer: 'Lê Đức Thọ' },
    { question: 'Năm nào diễn ra cuộc kháng chiến chống Mỹ ở miền Nam?', options: ['1954', '1960', '1965', '1975'], answer: '1965' },
    { question: 'Ai là người đã lãnh đạo cuộc tổng tấn công Tết Mậu Thân?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Lê Duẩn', 'Nguyễn Văn Linh'], answer: 'Võ Nguyên Giáp' },
    { question: 'Năm nào diễn ra chiến dịch Hồ Chí Minh?', options: ['1975', '1976', '1977', '1978'], answer: '1975' },
    { question: 'Ai là Tổng tư lệnh trong trận Điện Biên Phủ?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Nguyễn Văn Linh', 'Lê Duẩn'], answer: 'Võ Nguyên Giáp' },
    { question: 'Năm nào diễn ra cuộc tổng tấn công Tết Mậu Thân?', options: ['1968', '1969', '1970', '1971'], answer: '1968' },
    { question: 'Ai là người viết bản Tuyên ngôn độc lập của Việt Nam?', options: ['Hồ Chí Minh', 'Trường Chinh', 'Lê Duẩn', 'Nguyễn Văn Linh'], answer: 'Hồ Chí Minh' },
    { question: 'Cuộc kháng chiến chống Pháp ở Việt Nam kết thúc vào năm nào?', options: ['1954', '1955', '1956', '1957'], answer: '1954' },
    { question: 'Năm nào diễn ra cuộc chiến tranh biên giới Việt - Trung?', options: ['1979', '1980', '1981', '1982'], answer: '1979' },
    { question: 'Ai là người lãnh đạo cuộc kháng chiến chống Pháp ở miền Bắc?', options: ['Hồ Chí Minh', 'Võ Nguyên Giáp', 'Lê Duẩn', 'Trường Chinh'], answer: 'Hồ Chí Minh' },
    { question: 'Năm nào diễn ra cuộc tổng tấn công vào Sài Gòn?', options: ['1975', '1976', '1977', '1978'], answer: '1975' },
    { question: 'Ai là Tổng thống đầu tiên của Việt Nam Cộng Hòa?', options: ['Nguyễn Văn Thiệu', 'Ngô Đình Diệm', 'Trần Văn Hương', 'Lê Văn Viễn'], answer: 'Ngô Đình Diệm' },
    { question: 'Năm nào Việt Nam giành được độc lập?', options: ['1945', '1946', '1947', '1948'], answer: '1945' }
];

        function getUsername(userId) {
            db.collection("users").doc(userId).get().then((doc) => {
                if (doc.exists) {
                    const fullName = doc.data().fullName;
                    usernameElement.textContent = `Họ và tên: "${fullName}"`;
                    username = fullName;
                } else {
                    console.log("Không tìm thấy tài liệu người dùng!");
                }
            }).catch((error) => {
                console.log("Lỗi khi lấy tài liệu:", error);
            });
        }
        function goBack() {
            window.location.href = 'home.html'; // Chuyển hướng về trang chủ
        }

        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                const userId = user.uid;
                getUsername(userId);
                startTimer();
                displayQuestions();
                startCamera();
            } else {
                window.location.href = 'login.html';
            }
        });

        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    document.getElementById('camera').srcObject = stream;
                    monitorCamera(stream);
                })
                .catch(err => {
                    console.error("Lỗi khi truy cập camera: ", err);
                    alert("Không thể truy cập camera. Vui lòng kiểm tra thiết bị của bạn.");
                    submitQuiz(); // Tự động nộp bài khi không có quyền truy cập camera
                });
        }

        function monitorCamera(stream) {
            const videoTracks = stream.getVideoTracks();
            videoTracks[0].addEventListener('ended', () => {
                handleCameraOff();
            });
        }

        function handleCameraOff() {
            cameraActive = false; // Đánh dấu camera đã bị tắt
            alert("Camera đã bị tắt! Bài thi sẽ tự động nộp.");
            submitQuiz(); // Tự động nộp bài ngay khi camera bị tắt
        }

        function saveQuizResult(correctCount) {
            const userId = firebase.auth().currentUser.uid;
            db.collection("quizResults").add({
                userId: userId,
                fullName: username,
                score: correctCount,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                console.log("Quiz result successfully written!");
            }).catch((error) => {
                console.error("Error writing quiz result: ", error);
            });
        }

        function getRandomQuestions(n) {
            const shuffled = questionBank.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, n);
        }

        function displayQuestions() {
            const quizForm = document.getElementById("quizForm");
            if (!quizForm) {
                console.error("Không tìm thấy phần tử #quizForm");
                return;
            }

            selectedQuestions = getRandomQuestions(20);
            selectedQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question');

                const questionTitle = document.createElement('p');
                questionTitle.textContent = `Câu hỏi ${index + 1}: ${q.question}`;
                questionDiv.appendChild(questionTitle);

                q.options.forEach((option, i) => {
                    const label = document.createElement('label');
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = `q${index + 1}`;
                    radio.value = option;
                    label.appendChild(radio);
                    label.appendChild(document.createTextNode(` ${String.fromCharCode(65 + i)}. ${option}`));
                    questionDiv.appendChild(label);
                    questionDiv.appendChild(document.createElement('br'));
                });

                quizForm.appendChild(questionDiv);
            });
        }

        function startTimer() {
            const interval = setInterval(() => {
                const minutes = Math.floor(timerValue / 60);
                const seconds = timerValue % 60;
                timerElement.textContent = `Thời gian: 0${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                timerValue--;

                if (timerValue < 0) {
                    clearInterval(interval);
                    submitQuiz();
                }
            }, 1000);
        }

        function submitQuiz() {
            let correctCount = 0;
            const formData = new FormData(quizForm);

            formData.forEach((value, key) => {
                const questionIndex = parseInt(key.slice(1)) - 1;
                if (selectedQuestions[questionIndex].answer === value) {
                    correctCount++;
                }
            });

            const inputs = quizForm.querySelectorAll('input');
            inputs.forEach(input => {
                input.disabled = true;
            });

            message.style.display = 'block';
            message.textContent = `Cảm ơn bạn đã hoàn thành bài thi! Bạn trả lời đúng ${correctCount}/20 câu.`;

            if (correctCount >= 15) {
                certBtn.style.display = 'block';
            } else {
                setTimeout(() => {
                    window.location.href = 'home.html';
                }, 3000);
            }

            saveQuizResult(correctCount);
        }

        function getCertificate() {
            window.location.href = 'chungchi.html';
        }

        // Drag and Drop for Camera
        const cameraFrame = document.getElementById('cameraFrame');
        let offsetX, offsetY;

        cameraFrame.addEventListener('mousedown', function (e) {
            offsetX = e.clientX - cameraFrame.getBoundingClientRect().left;
            offsetY = e.clientY - cameraFrame.getBoundingClientRect().top;
            document.addEventListener('mousemove', dragCameraFrame);
            document.addEventListener('mouseup', stopDragging);
        });

        function dragCameraFrame(e) {
            cameraFrame.style.left = (e.clientX - offsetX) + 'px';
            cameraFrame.style.top = (e.clientY - offsetY) + 'px';
        }

        function stopDragging() {
            document.removeEventListener('mousemove', dragCameraFrame);
            document.removeEventListener('mouseup', stopDragging);
        }
    </script>
</body>

</html>